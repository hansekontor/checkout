{"ast":null,"code":"/*!\n * rc4.js - RC4 for javascript\n * Copyright (c) 2018-2019, Christopher Jeffrey (MIT License).\n * https://github.com/bcoin-org/bcrypto\n *\n * Parts of this software are based on golang/go:\n *   Copyright (c) 2009, The Go Authors. All rights reserved.\n *   https://github.com/golang/go\n *\n * Resources:\n *   https://en.wikipedia.org/wiki/RC4\n *   http://cypherpunks.venona.com/archive/1994/09/msg00304.html\n *   https://web.archive.org/web/20080207125928/http://cypherpunks.venona.com/archive/1994/09/msg00304.html\n *   https://tools.ietf.org/html/rfc4345\n *   https://tools.ietf.org/html/rfc6229\n *   https://github.com/golang/go/blob/master/src/crypto/rc4/rc4.go\n */\n'use strict';\n\nconst assert = require('./internal/assert');\n/**\n * RC4\n */\n\n\nclass RC4 {\n  constructor() {\n    this.s = new Uint32Array(256);\n    this.i = -1;\n    this.j = -1;\n  }\n\n  init(key) {\n    assert(Buffer.isBuffer(key));\n    const k = key.length;\n    if (k < 1 || k > 256) throw new Error('Invalid key size.');\n    const s = this.s;\n\n    for (let i = 0; i < 256; i++) s[i] = i;\n\n    let j = 0;\n\n    for (let i = 0; i < 256; i++) {\n      j += s[i] + key[i % k];\n      j &= 0xff;\n      [s[i], s[j]] = [s[j], s[i]];\n    }\n\n    this.i = 0;\n    this.j = 0;\n    return this;\n  }\n\n  encrypt(data) {\n    assert(Buffer.isBuffer(data));\n    if (this.i === -1) throw new Error('Context is not initialized.');\n    const s = this.s;\n    let {\n      i,\n      j\n    } = this;\n    let x, y;\n\n    for (let k = 0; k < data.length; k++) {\n      i = i + 1 & 0xff;\n      x = s[i];\n      j = j + x & 0xff;\n      y = s[j];\n      s[i] = y;\n      s[j] = x;\n      data[k] ^= s[x + y & 0xff];\n    }\n\n    this.i = i;\n    this.j = j;\n    return data;\n  }\n\n  destroy() {\n    for (let i = 0; i < 256; i++) this.s[i] = 0;\n\n    this.i = -1;\n    this.j = -1;\n    return this;\n  }\n\n}\n/*\n * Static\n */\n\n\nRC4.native = 0;\n/*\n * Expose\n */\n\nmodule.exports = RC4;","map":null,"metadata":{},"sourceType":"script"}