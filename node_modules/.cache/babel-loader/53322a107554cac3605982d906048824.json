{"ast":null,"code":"/*!\n * sec1.js - SEC1 encoding for javascript\n * Copyright (c) 2018-2019, Christopher Jeffrey (MIT License).\n * https://github.com/bcoin-org/bcrypto\n *\n * Parts of this software are based on golang/go:\n *   Copyright (c) 2009, The Go Authors. All rights reserved.\n *   https://github.com/golang/go\n *\n * Resources:\n *   http://www.secg.org/sec1-v2.pdf\n *   https://github.com/openssl/openssl/blob/master/crypto/ec/ec_asn1.c\n *   https://github.com/golang/go/blob/master/src/crypto/x509/sec1.go\n *   https://tools.ietf.org/html/rfc5915\n */\n'use strict';\n\nconst asn1 = require('./asn1');\n\nconst pem = require('./pem');\n/**\n * ECPrivateKey\n */\n// ECPrivateKey ::= SEQUENCE {\n//   version INTEGER { ecPrivkeyVer1(1) } (ecPrivkeyVer1),\n//   privateKey OCTET STRING,\n//   parameters [0] ECDomainParameters {{ SECGCurveNames }} OPTIONAL,\n//   publicKey [1] BIT STRING OPTIONAL\n// }\n// ECDomainParameters{ECDOMAIN:IOSet} ::= CHOICE {\n//   specified SpecifiedECDomain,\n//   named ECDOMAIN.&id({IOSet}),\n//   implicitCA NULL\n// }\n// ECDOMAIN ::= CLASS {\n//   &id OBJECT IDENTIFIER UNIQUE\n// }\n// Golang seems to be using this instead:\n// ECPrivateKey ::= SEQUENCE {\n//   version       INTEGER { ecPrivkeyVer1(1) },\n//   privateKey    OCTET STRING,\n//   parameters    [0] EXPLICIT ECDomainParameters OPTIONAL,\n//   publicKey     [1] EXPLICIT BIT STRING OPTIONAL\n// }\n\n\nclass ECPrivateKey extends asn1.Sequence {\n  constructor(version, privateKey, namedCurveOID, publicKey) {\n    super();\n    this.version = new asn1.Unsigned(version);\n    this.privateKey = new asn1.OctString(privateKey);\n    this.namedCurveOID = new asn1.OID(namedCurveOID).explicit(0).optional();\n    this.publicKey = new asn1.BitString(publicKey).explicit(1).optional();\n  }\n\n  getBodySize() {\n    let size = 0;\n    size += this.version.getSize();\n    size += this.privateKey.getSize();\n    size += this.namedCurveOID.getSize();\n    size += this.publicKey.getSize();\n    return size;\n  }\n\n  writeBody(bw) {\n    this.version.write(bw);\n    this.privateKey.write(bw);\n    this.namedCurveOID.write(bw);\n    this.publicKey.write(bw);\n    return bw;\n  }\n\n  readBody(br) {\n    this.version.read(br);\n    this.privateKey.read(br);\n    this.namedCurveOID.read(br);\n    this.publicKey.read(br);\n    return this;\n  }\n\n  clean() {\n    return this.version.clean() && this.privateKey.clean() && this.namedCurveOID.clean() && this.publicKey.clean();\n  }\n\n  toPEM() {\n    return pem.toPEM(this.encode(), 'EC PRIVATE KEY');\n  }\n\n  fromPEM(str) {\n    const data = pem.fromPEM(str, 'EC PRIVATE KEY');\n    return this.decode(data);\n  }\n\n  format() {\n    return {\n      type: this.constructor.name,\n      version: this.version,\n      privateKey: this.privateKey,\n      namedCurveOID: this.namedCurveOID,\n      publicKey: this.publicKey\n    };\n  }\n\n}\n/**\n * ECDSA Signature\n */\n// ECDSA-Signature ::= CHOICE {\n//   two-ints-plus ECDSA-Sig-Value,\n//   point-int [0] ECDSA-Full-R,\n//   ... -- Future representations may be added\n// }\n// ECDSA-Full-R ::= SEQUENCE {\n//   r ECPoint,\n//   s INTEGER\n// }\n// ECPoint ::= OCTET STRING\n// ECDSA-Sig-Value ::= SEQUENCE {\n//   r INTEGER,\n//   s INTEGER,\n//   a INTEGER OPTIONAL,\n//   y CHOICE { b BOOLEAN, f FieldElement } OPTIONAL\n// }\n\n\nclass ECDSASignature extends asn1.Sequence {\n  constructor(r, s) {\n    super();\n    this.r = new asn1.Unsigned(r);\n    this.s = new asn1.Unsigned(s);\n  }\n\n  getBodySize() {\n    let size = 0;\n    size += this.r.getSize();\n    size += this.s.getSize();\n    return size;\n  }\n\n  writeBody(bw) {\n    this.r.write(bw);\n    this.s.write(bw);\n    return bw;\n  }\n\n  readBody(br) {\n    this.r.read(br);\n    this.s.read(br);\n    return this;\n  }\n\n  clean() {\n    return this.r.clean() && this.s.clean();\n  }\n\n  toPEM() {\n    return pem.toPEM(this.encode(), 'EC SIGNATURE');\n  }\n\n  fromPEM(str) {\n    const data = pem.fromPEM(str, 'EC SIGNATURE');\n    return this.decode(data);\n  }\n\n  format() {\n    return {\n      type: this.constructor.name,\n      r: this.r,\n      s: this.s\n    };\n  }\n\n}\n/*\n * Expose\n */\n\n\nexports.ECPrivateKey = ECPrivateKey;\nexports.ECDSASignature = ECDSASignature;","map":null,"metadata":{},"sourceType":"script"}