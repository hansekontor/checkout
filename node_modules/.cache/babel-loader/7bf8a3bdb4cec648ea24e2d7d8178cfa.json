{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar UnsupportedOperationException_1 = require(\"../UnsupportedOperationException\");\n\nvar CharacterSetECI_1 = require(\"../common/CharacterSetECI\");\n/**\r\n * Responsible for en/decoding strings.\r\n */\n\n\nvar StringEncoding =\n/** @class */\nfunction () {\n  function StringEncoding() {}\n  /**\r\n   * Decodes some Uint8Array to a string format.\r\n   */\n\n\n  StringEncoding.decode = function (bytes, encoding) {\n    var encodingName = this.encodingName(encoding); // Increases browser support.\n\n    if (typeof TextDecoder === 'undefined') {\n      return this.decodeFallback(bytes, encodingName);\n    }\n\n    return new TextDecoder(encodingName).decode(bytes);\n  };\n  /**\r\n   * Encodes some string into a Uint8Array.\r\n   *\r\n   * @todo natively support other string formats than UTF-8.\r\n   */\n\n\n  StringEncoding.encode = function (s, encoding) {\n    // Uses `text-encoding` package.\n    if (!StringEncoding.isBrowser()) {\n      // SEE: https://nodejs.org/api/buffer.html#buffer_class_buffer\n      // SEE: https://github.com/polygonplanet/encoding.js/\n      // SEE: https://stackoverflow.com/questions/17191945/conversion-between-utf-8-arraybuffer-and-string\n      var EncoderConstructor = TextEncoder;\n      return new EncoderConstructor(this.encodingName(encoding), {\n        NONSTANDARD_allowLegacyEncoding: true\n      }).encode(s);\n    } // Increases browser support.\n\n\n    if (typeof TextEncoder === 'undefined') {\n      return this.encodeFallback(s);\n    } // TextEncoder only encodes to UTF8 by default as specified by encoding.spec.whatwg.org\n\n\n    return new TextEncoder().encode(s);\n  };\n\n  StringEncoding.isBrowser = function () {\n    return typeof window !== 'undefined' && {}.toString.call(window) === '[object Window]';\n  };\n  /**\r\n   * Returns the string value from some encoding character set.\r\n   */\n\n\n  StringEncoding.encodingName = function (encoding) {\n    return typeof encoding === 'string' ? encoding : encoding.getName();\n  };\n  /**\r\n   * Returns character set from some encoding character set.\r\n   */\n\n\n  StringEncoding.encodingCharacterSet = function (encoding) {\n    return CharacterSetECI_1.default.getCharacterSetECIByName(this.encodingName(encoding));\n  };\n  /**\r\n   * Runs a fallback for the native decoding funcion.\r\n   */\n\n\n  StringEncoding.decodeFallback = function (bytes, encoding) {\n    var characterSet = this.encodingCharacterSet(encoding);\n\n    if (characterSet.equals(CharacterSetECI_1.default.UTF8) || characterSet.equals(CharacterSetECI_1.default.ISO8859_1) || characterSet.equals(CharacterSetECI_1.default.ASCII)) {\n      var s = '';\n\n      for (var i = 0, length_1 = bytes.length; i < length_1; i++) {\n        var h = bytes[i].toString(16);\n\n        if (h.length < 2) {\n          h = '0' + h;\n        }\n\n        s += '%' + h;\n      }\n\n      return decodeURIComponent(s);\n    }\n\n    if (characterSet.equals(CharacterSetECI_1.default.UnicodeBigUnmarked)) {\n      return String.fromCharCode.apply(null, new Uint16Array(bytes.buffer));\n    }\n\n    throw new UnsupportedOperationException_1.default(\"Encoding \" + this.encodingName(encoding) + \" not supported by fallback.\");\n  };\n  /**\r\n   * Runs a fallback for the native encoding funcion.\r\n   *\r\n   * @see https://stackoverflow.com/a/17192845/4367683\r\n   */\n\n\n  StringEncoding.encodeFallback = function (s) {\n    var encodedURIstring = btoa(unescape(encodeURIComponent(s)));\n    var charList = encodedURIstring.split('');\n    var uintArray = [];\n\n    for (var i = 0; i < charList.length; i++) {\n      uintArray.push(charList[i].charCodeAt(0));\n    }\n\n    return new Uint8Array(uintArray);\n  };\n\n  return StringEncoding;\n}();\n\nexports.default = StringEncoding;","map":null,"metadata":{},"sourceType":"script"}